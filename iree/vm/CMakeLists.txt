# Copyright 2019 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

iree_cc_library(
  NAME
    api
  HDRS
    "api.h"
  SRCS
    "api.cc"
  DEPS
    iree::vm::api_hdrs
    iree::vm::sequencer_module
    iree::base::api
    iree::base::api_util
    iree::base::flatbuffer_util
    iree::base::tracing
    iree::rt::api
  PUBLIC
)

iree_cc_library(
  NAME
    api_hdrs
  HDRS
    "api.h"
  DEPS
    iree::base::api_hdrs
    iree::rt::api_hdrs
  PUBLIC
)

iree_cc_library(
  NAME
    bytecode_module
  SRCS
    "bytecode_disassembler.cc"
    "bytecode_module.cc"
  HDRS
    "bytecode_disassembler.h"
    "bytecode_module.h"
  DEPS
    iree::vm::bytecode_util
    iree::vm::opcode_info
    iree::vm::source_map_resolver
    iree::vm::type
    iree::base::flatbuffer_util
    iree::base::status
    iree::base::tracing
    iree::hal::buffer_view
    iree::rt
    iree::schemas
    iree::schemas::bytecode::bytecode_v0
    absl::core_headers
    absl::inlined_vector
    absl::memory
    absl::strings
    absl::span
  PUBLIC
)

iree_cc_library(
  NAME
    bytecode_reader
  SRCS
    "bytecode_reader.cc"
  HDRS
    "bytecode_reader.h"
  DEPS
    iree::vm::bytecode_module
    iree::vm::type
    iree::base::shape
    iree::base::status
    iree::hal::buffer_view
    iree::hal::heap_buffer
    iree::rt
    iree::schemas::bytecode::bytecode_v0
    absl::core_headers
    absl::inlined_vector
  PUBLIC
)

iree_cc_library(
  NAME
    bytecode_tables_interpreter
  SRCS
    "bytecode_tables_interpreter.cc"
  HDRS
    "bytecode_tables_interpreter.h"
  DEPS
    iree::vm::opcode_info
    iree::schemas::bytecode::interpreter_bytecode_v0
  PUBLIC
)

iree_cc_library(
  NAME
    bytecode_tables_sequencer
  SRCS
    "bytecode_tables_sequencer.cc"
  HDRS
    "bytecode_tables_sequencer.h"
  DEPS
    iree::vm::opcode_info
    iree::schemas::bytecode::sequencer_bytecode_v0
    PUBLIC
)

iree_cc_library(
  NAME
    bytecode_util
  SRCS
    "bytecode_util.cc"
  HDRS
    "bytecode_util.h"
  DEPS
    iree::schemas::bytecode::bytecode_v0
    absl::strings
  PUBLIC
)

iree_cc_library(
  NAME
    bytecode_validator
  SRCS
    "bytecode_validator.cc"
  HDRS
    "bytecode_validator.h"
  DEPS
    iree::vm::bytecode_module
    iree::base::status
    iree::schemas
  PUBLIC
)

iree_cc_library(
  NAME
    opcode_info
  HDRS
    "opcode_info.h"
  DEPS
    iree::schemas::bytecode::bytecode_v0
    absl::strings
    absl::optional
    absl::span
  PUBLIC
)

iree_cc_library(
  NAME
    sequencer_dispatch
  SRCS
    "sequencer_dispatch.cc"
  HDRS
    "sequencer_dispatch.h"
  DEPS
    iree::vm::bytecode_module
    iree::vm::bytecode_reader
    iree::vm::bytecode_tables_sequencer
    iree::vm::bytecode_util
    iree::vm::opcode_info
    iree::base::logging
    iree::base::memory
    iree::base::status
    iree::hal::buffer_view
    iree::hal::command_queue
    iree::hal::device
    iree::hal::device_placement
    iree::hal::heap_buffer
    iree::rt
    iree::schemas::bytecode::sequencer_bytecode_v0
    absl::core_headers
    absl::inlined_vector
    absl::strings
    absl::time
    absl::span
  PUBLIC
)

iree_cc_library(
  NAME
    sequencer_module
  SRCS
    "sequencer_module.cc"
  HDRS
    "sequencer_module.h"
  DEPS
    iree::vm::bytecode_module
    iree::vm::bytecode_tables_sequencer
    iree::vm::sequencer_dispatch
    iree::base::status
    iree::base::tracing
    iree::hal::buffer_view
    iree::rt
    absl::memory
  PUBLIC
)

iree_cc_library(
  NAME
    source_map_resolver
  SRCS
    "source_map_resolver.cc"
  HDRS
    "source_map_resolver.h"
  DEPS
    iree::base::flatbuffer_util
    iree::base::status
    iree::rt
    iree::schemas
    absl::strings
    absl::optional
  PUBLIC
)

iree_cc_library(
  NAME
    type
  SRCS
    "type.cc"
  HDRS
    "type.h"
  DEPS
    iree::base::status
    iree::schemas
    iree::schemas::bytecode::bytecode_v0
  PUBLIC
)
