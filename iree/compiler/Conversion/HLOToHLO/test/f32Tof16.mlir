// RUN: iree-opt -split-input-file -iree-convert-f32-to-f16 %s | IreeFileCheck %s

//       CHECK: flow.variable {{.*}} : tensor<512xf16>
// CHECK-LABEL: func @serving_default() -> tensor<512xf16>
//  CHECK-NEXT: %{{.*}} = flow.variable.address @"__iree_flow_bert/embeddings/FakeLayerNorm/beta" : !iree.ptr<tensor<512xf16>>
//  CHECK-NEXT: %{{.*}} = flow.variable.load.indirect %{{.*}} : !iree.ptr<tensor<512xf16>> -> tensor<512xf16>
//  CHECK-NEXT: return %{{.*}} : tensor<512xf16>
module attributes {tf.versions = {bad_consumers = [], min_consumer = 0 : i32, producer = 405 : i32}} {
  flow.variable @"__iree_flow_bert/embeddings/FakeLayerNorm/beta" dense<"0x95C9DCBB9165313C33E86DBBF6D25A3CB92CD83B42FA8CBC085734BD07F9F93C6C39953C9E21D2BA1CB1FC3CB1645C3C717F943C9245ACBC7ECBBB3BF10D623D26A0DDBB0C11FABB200F42BD938A64BB5A57633DD59C823CA7CF2B3CAB49E53B9940F4BB338884B828C1943D0F78B03C5A7B36BD50BFEA3DCCD27F3C72BA903CC065A03B895D993CF83F2A3D3DA5E4BD2860233DFAD7193C5ED42FBCA1DCECB82F08E43B93360E3CBF3028BDD048A93B664D6A3CBD309BBC120329BC405362BD5355D03B1298C73D2642763CD6F35A3DCD8843BDE489C33B349CC3BC087D95BCFC6848BB3DD6E2BBECD8E1BC3CD35FBD0CF9963C7D9645BDFD021A3C602BA83D70FF253D4C6D7BBB2B2B743DB58C42BD8D810E3D62E8CF3C8B34AABC0B7E3F3C6AB2613C41442A3C04E18B3D59D6E8BC7138DBBC0D23AEBC1AEAAC3A835EB43C165C9F3D4212E73D4A85BBBC04C62ABCE0D60CBD56C9733D1C26F63CA326DEBCD7193C3CC8E298BD6EE587BD3C59B7BCB53397BC64FA39BD40AE14BE91A456BD8EE52D3D8C03113DBE63A0BCAA4E3DBD9C7A7D3D1459D43C24942A3DFB446FBDE40DD03C88254ABDF28D233E6B4AAFBC79A9273C2F25D0BBEEB6863CC9D3D3BCF8BBBAB7EA7AD8BC340BE23DDE55D33C1538173D95D6FCBB50D72BBD3DA72FBC055C9B3D26254CBD1D589C3BE514B3BC6DD2413C020AB63B43C2E93C22FC7EBB47BBBBBD6711513D0140BE3C461610BDD71713BD309A243C07FE503A439913BDAB285F3D8158C63D338A58BCB5DF39BCFEBCC63C8A06113DE77979BCEB1D813CF05547BD9017C9BA62D3533C9BA2233C5AA269BD4029C4B91CFB29BA734537BB0CC6C7B89B698B3D50E9523DC2580D3D0291973C68C48D3C907E53BA18B5323D6A8CB73CA49711BBD1F0153B5F41C93BF2CD2ABD0450053DEF43583DE53ED73C2CD36EBC582D213C794C55BC0129B4BCE677CCBC65BBB43C67F5843CD463303DF2FE15BC13A586BC7D1429BD6FDD313D54CDF0BA59F09BBC659F0C3DDE89013D80F10F3D3478373DAC81C1BCC5CCFC3D97331C3C68FF033D6F8B37BCC9BC4CBBCFFF113D8EFAD43C0C2308BE7ECC96BBE302A7BCECD62E3D2AC60E3DE94EF0BCA2EE4F3C7443ABBD6DDEAF3CEB5CE3BC0369583C5267CE3C46E74E3DC7D92EBC8C78D0BCB60B81BAC6002BBD78BD3C3DF2E3FD3B2F32AB3CC8BA583C2232B939A2B021BD7BCF3CBD8067C8BB40699F3B06D2C1BC503FFFBC8D4593BC64F0BA3C6D125ABD52DF263CE2CF453D081F6EBDE586C4BCCDBD043B3D3A1F3D3A1D45BDE57C953CD8D2A2BB37F30FBCA4CDA63C3C3CB23B2AE0043C2F31AFBCA461D1BC928D9DBCE079623D7F5AF2BBC6B3F0BBF61189BB65A7BDBC67FB823DA81B29BD3B8973BD2A23E03D05C16BBAFC89CDBCFCE429BCB418273B485769BA793A13BD24A15EBB69DC253CE2A205BD1F1788BDE1A294BD1E43203DB756A83C1B42E1BC552AE73C0AFB5DBD2210EABB26B1D93C12B01D3C725322BD89371FBEFCB541BC1364233C12CC243C94C2C6BB68E1B03DFBB842BF63EDF73BBA2FB63D766C1FBCDA3433BC04D966BCC8CF5C3CD24F08BEA988C23B516BCD3C5E799B3C0CB2373CFAC0063B4803B13CEF52B3BCBD7503BDE9F6CEBC16014CBC4AF2013D9BA7823BD29F4DBF9DF40FBCFB5CD63B4C06AF3CC1CFA8BD32CEC33C7AD2883D949C0CBEB405E8BC497910BD16B9113DDBBF643C68D9473DD2E0B83C37E000BC0E00093DD313CC3C148C0CBD4E51C83C81460DBDFE128E3CF985BDBC2D7DA43CD22A4CBDD3A52F3B96C91B3DCC05133C2BD8D63C775DB63DAD9346BD1FC2CFBC155DE33CDADBDFBAD33AE53B990FD03CE057363B3CE3DDBC5C39543C6948C23C5F5E2D3D6F21DD3BF9A2DC3CB5DE36BD5EC2FEBA69CB02BD6CBAA83B22B0CBBD37AC8E3D2341BB3C5FF4DABD59F6323CCF81DEBDA1E42DBD8DA384BC94104B3B09C0873B6B7135BC0E08B13AF410283DE4F7F23C650F343D10CD353DF09B353C3008393DE5A4763DDBFF083A22D1F4BCF19CAFBCA3EF78BDEDEDD33C536CA93B8AC9CD3D8E9ED33D2A1E0E3CC0EF96BC3444D33CE3A70F3D9F4F90BDC2C1873C778ABB3C3973DABDB4AF3EBDBA444B3D6CC02EBC89CE12BC8334703C464C2BBC3C6B533D19CDFDBB01A3FA3B94EA27BC509816BC7D8C923CAD9F243C54A2AD3ADEFA6BBD97B4813CBA088E3CB9D540BCA7BA53BD2A01403C6EBF4BBC6C7F0D3D98B1CD3CE6A21F3C20541D3B9EF0BE3BE03F5EBC540F9FBD8510063D0A6BBCBCDCCA3B3C27C2813B56469BBBBF1FBD3C2F96553CCFBF083DBB16CEBAF6FFFEBBADD75FBD439823BD98D58E3CE1D5A0BCA2C110BD57E9EABC2E692A3BFFCCB43AB28BB9BB9FC4C2BB3904B83C8AF09C3D105F23BDC0BFCFBC0BE8133B57DF223C9E38513DCF46543DCC6D713C0685463BA266343DE08121BD6E34C9BCF3495ABCB99A453D40CA143C3A6AA4BD263D6FBB139E023DC1E1F2BB1F580F3CDFB6753D8820A93D22EF47BD807DCA3BC1C558BD9AA3E23C5EF6383BD31E6CBD315B2ABDAF8197BA81FCAC3C3B0C4CBDF77488BCF40AE43B616AF93C8994B63D7A42FC3C68FAA0BC4630CF3C9DC81ABCF39201BD72683E3C074590BCC40E0DBDE02698BA8EF0BB3CB3C3DA3CE2909B3D5FDCA63C1F49C03C07544C3D6BF1E7BCE463A1BC0DC3D3BC4561733D7E25063DC0358FBD4348BEBCD8D0383DA4FFAD3CAA1A8B3CFD452C3D4E04383D1D046EBCCC11AF3CACC121BC46FA0D3D645D753C2A81CAB922D22A3DF52E533D5E5641BD60BDE63CD226A83DC23B83BDF0F6F4BB37B5C2BC0AD19F3C25BAA23CB799323C9CF40E3D6A186A3DDD37563C41FC27BDE785D53C6B294D3D"> : tensor<512xf32> attributes {sym_visibility = "private"}
  func @serving_default() -> (tensor<512xf32>) attributes {iree.module.export, iree.reflection = {abi = "sip", abiv = 1 : i32, sip = "I53!D49!K10!input_ids_0K11!input_mask_1K12!segment_ids_2R39!D35!K11!end_logits_1K13!start_logits_0"}, tf.entry_function = {control_outputs = "", inputs = "input_ids:0,input_mask:0,segment_ids:0", outputs = "start_logits:0,end_logits:0"}} {
    %0 = flow.variable.address @"__iree_flow_bert/embeddings/FakeLayerNorm/beta" : !iree.ptr<tensor<512xf32>>
    %1 = flow.variable.load.indirect %0 : !iree.ptr<tensor<512xf32>> -> tensor<512xf32>
    return %1 : tensor<512xf32>
  }
}

// -----

// CHECK: flow.variable
// CHECK-NOT: f32
// CHECK-LABEL: func @serving_default()
// CHECK-NOT: f32
// CHECK: return %{{.*}} : tensor<512xf16>
module attributes {tf.versions = {bad_consumers = [], min_consumer = 0 : i32, producer = 405 : i32}} {
  flow.variable @"__iree_flow_bert/embeddings/FakeLayerNorm/beta" dense<"0x95C9DCBB9165313C33E86DBBF6D25A3CB92CD83B42FA8CBC085734BD07F9F93C6C39953C9E21D2BA1CB1FC3CB1645C3C717F943C9245ACBC7ECBBB3BF10D623D26A0DDBB0C11FABB200F42BD938A64BB5A57633DD59C823CA7CF2B3CAB49E53B9940F4BB338884B828C1943D0F78B03C5A7B36BD50BFEA3DCCD27F3C72BA903CC065A03B895D993CF83F2A3D3DA5E4BD2860233DFAD7193C5ED42FBCA1DCECB82F08E43B93360E3CBF3028BDD048A93B664D6A3CBD309BBC120329BC405362BD5355D03B1298C73D2642763CD6F35A3DCD8843BDE489C33B349CC3BC087D95BCFC6848BB3DD6E2BBECD8E1BC3CD35FBD0CF9963C7D9645BDFD021A3C602BA83D70FF253D4C6D7BBB2B2B743DB58C42BD8D810E3D62E8CF3C8B34AABC0B7E3F3C6AB2613C41442A3C04E18B3D59D6E8BC7138DBBC0D23AEBC1AEAAC3A835EB43C165C9F3D4212E73D4A85BBBC04C62ABCE0D60CBD56C9733D1C26F63CA326DEBCD7193C3CC8E298BD6EE587BD3C59B7BCB53397BC64FA39BD40AE14BE91A456BD8EE52D3D8C03113DBE63A0BCAA4E3DBD9C7A7D3D1459D43C24942A3DFB446FBDE40DD03C88254ABDF28D233E6B4AAFBC79A9273C2F25D0BBEEB6863CC9D3D3BCF8BBBAB7EA7AD8BC340BE23DDE55D33C1538173D95D6FCBB50D72BBD3DA72FBC055C9B3D26254CBD1D589C3BE514B3BC6DD2413C020AB63B43C2E93C22FC7EBB47BBBBBD6711513D0140BE3C461610BDD71713BD309A243C07FE503A439913BDAB285F3D8158C63D338A58BCB5DF39BCFEBCC63C8A06113DE77979BCEB1D813CF05547BD9017C9BA62D3533C9BA2233C5AA269BD4029C4B91CFB29BA734537BB0CC6C7B89B698B3D50E9523DC2580D3D0291973C68C48D3C907E53BA18B5323D6A8CB73CA49711BBD1F0153B5F41C93BF2CD2ABD0450053DEF43583DE53ED73C2CD36EBC582D213C794C55BC0129B4BCE677CCBC65BBB43C67F5843CD463303DF2FE15BC13A586BC7D1429BD6FDD313D54CDF0BA59F09BBC659F0C3DDE89013D80F10F3D3478373DAC81C1BCC5CCFC3D97331C3C68FF033D6F8B37BCC9BC4CBBCFFF113D8EFAD43C0C2308BE7ECC96BBE302A7BCECD62E3D2AC60E3DE94EF0BCA2EE4F3C7443ABBD6DDEAF3CEB5CE3BC0369583C5267CE3C46E74E3DC7D92EBC8C78D0BCB60B81BAC6002BBD78BD3C3DF2E3FD3B2F32AB3CC8BA583C2232B939A2B021BD7BCF3CBD8067C8BB40699F3B06D2C1BC503FFFBC8D4593BC64F0BA3C6D125ABD52DF263CE2CF453D081F6EBDE586C4BCCDBD043B3D3A1F3D3A1D45BDE57C953CD8D2A2BB37F30FBCA4CDA63C3C3CB23B2AE0043C2F31AFBCA461D1BC928D9DBCE079623D7F5AF2BBC6B3F0BBF61189BB65A7BDBC67FB823DA81B29BD3B8973BD2A23E03D05C16BBAFC89CDBCFCE429BCB418273B485769BA793A13BD24A15EBB69DC253CE2A205BD1F1788BDE1A294BD1E43203DB756A83C1B42E1BC552AE73C0AFB5DBD2210EABB26B1D93C12B01D3C725322BD89371FBEFCB541BC1364233C12CC243C94C2C6BB68E1B03DFBB842BF63EDF73BBA2FB63D766C1FBCDA3433BC04D966BCC8CF5C3CD24F08BEA988C23B516BCD3C5E799B3C0CB2373CFAC0063B4803B13CEF52B3BCBD7503BDE9F6CEBC16014CBC4AF2013D9BA7823BD29F4DBF9DF40FBCFB5CD63B4C06AF3CC1CFA8BD32CEC33C7AD2883D949C0CBEB405E8BC497910BD16B9113DDBBF643C68D9473DD2E0B83C37E000BC0E00093DD313CC3C148C0CBD4E51C83C81460DBDFE128E3CF985BDBC2D7DA43CD22A4CBDD3A52F3B96C91B3DCC05133C2BD8D63C775DB63DAD9346BD1FC2CFBC155DE33CDADBDFBAD33AE53B990FD03CE057363B3CE3DDBC5C39543C6948C23C5F5E2D3D6F21DD3BF9A2DC3CB5DE36BD5EC2FEBA69CB02BD6CBAA83B22B0CBBD37AC8E3D2341BB3C5FF4DABD59F6323CCF81DEBDA1E42DBD8DA384BC94104B3B09C0873B6B7135BC0E08B13AF410283DE4F7F23C650F343D10CD353DF09B353C3008393DE5A4763DDBFF083A22D1F4BCF19CAFBCA3EF78BDEDEDD33C536CA93B8AC9CD3D8E9ED33D2A1E0E3CC0EF96BC3444D33CE3A70F3D9F4F90BDC2C1873C778ABB3C3973DABDB4AF3EBDBA444B3D6CC02EBC89CE12BC8334703C464C2BBC3C6B533D19CDFDBB01A3FA3B94EA27BC509816BC7D8C923CAD9F243C54A2AD3ADEFA6BBD97B4813CBA088E3CB9D540BCA7BA53BD2A01403C6EBF4BBC6C7F0D3D98B1CD3CE6A21F3C20541D3B9EF0BE3BE03F5EBC540F9FBD8510063D0A6BBCBCDCCA3B3C27C2813B56469BBBBF1FBD3C2F96553CCFBF083DBB16CEBAF6FFFEBBADD75FBD439823BD98D58E3CE1D5A0BCA2C110BD57E9EABC2E692A3BFFCCB43AB28BB9BB9FC4C2BB3904B83C8AF09C3D105F23BDC0BFCFBC0BE8133B57DF223C9E38513DCF46543DCC6D713C0685463BA266343DE08121BD6E34C9BCF3495ABCB99A453D40CA143C3A6AA4BD263D6FBB139E023DC1E1F2BB1F580F3CDFB6753D8820A93D22EF47BD807DCA3BC1C558BD9AA3E23C5EF6383BD31E6CBD315B2ABDAF8197BA81FCAC3C3B0C4CBDF77488BCF40AE43B616AF93C8994B63D7A42FC3C68FAA0BC4630CF3C9DC81ABCF39201BD72683E3C074590BCC40E0DBDE02698BA8EF0BB3CB3C3DA3CE2909B3D5FDCA63C1F49C03C07544C3D6BF1E7BCE463A1BC0DC3D3BC4561733D7E25063DC0358FBD4348BEBCD8D0383DA4FFAD3CAA1A8B3CFD452C3D4E04383D1D046EBCCC11AF3CACC121BC46FA0D3D645D753C2A81CAB922D22A3DF52E533D5E5641BD60BDE63CD226A83DC23B83BDF0F6F4BB37B5C2BC0AD19F3C25BAA23CB799323C9CF40E3D6A186A3DDD37563C41FC27BDE785D53C6B294D3D"> : tensor<512xf32> attributes {sym_visibility = "private"}
  func @serving_default() -> (tensor<512xf32>) attributes {iree.module.export, iree.reflection = {abi = "sip", abiv = 1 : i32, sip = "I53!D49!K10!input_ids_0K11!input_mask_1K12!segment_ids_2R39!D35!K11!end_logits_1K13!start_logits_0"}, tf.entry_function = {control_outputs = "", inputs = "input_ids:0,input_mask:0,segment_ids:0", outputs = "start_logits:0,end_logits:0"}} {
    %0 = flow.variable.address @"__iree_flow_bert/embeddings/FakeLayerNorm/beta" : !iree.ptr<tensor<512xf32>>
    %1 = flow.variable.load.indirect %0 : !iree.ptr<tensor<512xf32>> -> tensor<512xf32>
    %2 = "mhlo.broadcast_in_dim"(%1) {broadcast_dimensions = dense<0> : tensor<1xi64>} : (tensor<512xf32>) -> tensor<512x4xf32>
    %4 = mhlo.constant dense<0xFF800000> : tensor<f32>
    %3 = "mhlo.reduce"(%2, %4) ( {
    ^bb0(%arg3: tensor<f32>, %arg4: tensor<f32>):  // no predecessors
      %5393 = mhlo.maximum %arg3, %arg4 : tensor<f32>
      "mhlo.return"(%5393) : (tensor<f32>) -> ()
    }) {dimensions = dense<1> : tensor<1xi64>} : (tensor<512x4xf32>, tensor<f32>) -> tensor<512xf32>
    return %3 : tensor<512xf32>
  }
}
