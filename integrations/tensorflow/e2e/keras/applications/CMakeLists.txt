################################################################################
# Autogenerated by build_tools/bazel_to_cmake/bazel_to_cmake.py from           #
# integrations/tensorflow/e2e/keras/applications/BUILD                         #
#                                                                              #
# Use iree_cmake_extra_content from iree/build_defs.oss.bzl to add arbitrary   #
# CMake-only content.                                                          #
#                                                                              #
# To disable autogeneration for this file entirely, delete this header.        #
################################################################################

iree_add_all_subdirs()

file(GLOB _GLOB_X_TEST_PY LIST_DIRECTORIES false RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} CONFIGURE_DEPENDS *_test.py)
iree_e2e_cartesian_product_test_suite(
  NAME
    large_cifar10_tests
  MATRIX_KEYS
    "src"
    "reference_backend"
    "data"
    "model"
    "target_backends"
  MATRIX_VALUES
    "applications_test.py"
    "tf"
    "cifar10"
    "MobileNet;MobileNetV2;ResNet50;VGG16;VGG19"
    "tf;tflite;iree_llvmaot;iree_vulkan"
  FAILING_CONFIGURATIONS
    ",,,VGG19,tflite"
  LABELS
    "manual"
)

iree_e2e_cartesian_product_test_suite(
  NAME
    enormous_cifar10_tests
  MATRIX_KEYS
    "src"
    "reference_backend"
    "data"
    "model"
    "target_backends"
  MATRIX_VALUES
    "applications_test.py"
    "tf"
    "cifar10"
    "DenseNet121;DenseNet169;DenseNet201;NASNetLarge;NASNetMobile;ResNet50V2;ResNet101;ResNet101V2;ResNet152;ResNet152V2"
    "tf;tflite;iree_llvmaot;iree_vulkan"
  LABELS
    "guitar"
    "manual"
    "nokokoro"
    "notap"
)

iree_e2e_cartesian_product_test_suite(
  NAME
    cifar10_non_hermetic_tests
  MATRIX_KEYS
    "src"
    "reference_backend"
    "data"
    "url"
    "use_external_weights"
    "model"
    "target_backends"
  MATRIX_VALUES
    "applications_test.py"
    "tf"
    "cifar10"
    "https://storage.googleapis.com/iree_models/"
    "True"
    "MobileNet;MobileNetV2;ResNet50"
    "tf;tflite;iree_llvmaot;iree_vulkan"
  LABELS
    "external"
    "guitar"
    "manual"
    "no-remote"
    "nokokoro"
    "notap"
)

iree_e2e_cartesian_product_test_suite(
  NAME
    imagenet_non_hermetic_tests
  MATRIX_KEYS
    "src"
    "reference_backend"
    "data"
    "use_external_weights"
    "model"
    "target_backends"
  MATRIX_VALUES
    "applications_test.py"
    "tf"
    "imagenet"
    "True"
    "DenseNet121;DenseNet169;DenseNet201;EfficientNetB0;EfficientNetB1;EfficientNetB2;EfficientNetB3;EfficientNetB4;EfficientNetB5;EfficientNetB6;EfficientNetB7;InceptionResNetV2;InceptionV3;MobileNet;MobileNetV2;MobileNetV3Large;MobileNetV3Small;NASNetLarge;NASNetMobile;ResNet101;ResNet101V2;ResNet152;ResNet152V2;ResNet50;ResNet50V2;VGG16;VGG19;Xception"
    "tf;tflite;iree_llvmaot;iree_vulkan"
  FAILING_CONFIGURATIONS
    ",,,,InceptionResNetV2,iree_llvmaot"
    ",,,,InceptionV3,iree_llvmaot"
    ",,,,NASNetLarge,iree_llvmaot"
    ",,,,NASNetMobile,iree_llvmaot"
    ",,,,ResNet152V2,iree_llvmaot"
    ",,,,InceptionResNetV2,iree_vulkan"
    ",,,,InceptionV3,iree_vulkan"
    ",,,,NASNetLarge,iree_vulkan"
    ",,,,NASNetMobile,iree_vulkan"
    ",,,,ResNet152V2,iree_vulkan"
  LABELS
    "external"
    "guitar"
    "manual"
    "nokokoro"
    "notap"
)

### BAZEL_TO_CMAKE_PRESERVES_ALL_CONTENT_BELOW_THIS_LINE ###

iree_tf_benchmark_suite(
  MODELS
    MobileNetV2
    MobileNetV3Small
  MODEL_SCRIPT
    applications_benchmark.py
  MODEL_SCRIPT_ARGS
    "--data=imagenet"
    "--use_external_weights=True"
  NEED_ARG_FOR_MODEL
  BENCHMARK_MODE
    "fp32-full-inference"
  TARGET_BACKEND
    iree_llvmaot
  TARGET_ARCH
    "CPU-ARM64-v8A"
  COMPILATION_FLAGS
    "--iree-llvm-target-triple=aarch64-none-linux-android29"
    "--iree-flow-inline-constants-max-byte-length=2048"
    "--iree-codegen-llvm-promote-workgroup-to-full-tiles=true"
  RUNTIME_FLAGS
    "--task_topology_group_count=3"
)

iree_tf_benchmark_suite(
  MODELS
    MobileNetV2
    MobileNetV3Small
  MODEL_SCRIPT
    applications_benchmark.py
  MODEL_SCRIPT_ARGS
    "--data=imagenet"
    "--use_external_weights=True"
  NEED_ARG_FOR_MODEL
  BENCHMARK_MODE
    "fp32-full-inference"
  TARGET_BACKEND
    iree_vulkan
  TARGET_ARCH
    "GPU-Adreno"
  COMPILATION_FLAGS
    "--iree-vulkan-target-triple=qualcomm-adreno640-unknown-android10"
    "--iree-flow-inline-constants-max-byte-length=16"
    "--iree-flow-dispatch-formation-enable-operand-fusion"
    "--iree-enable-fusion-with-reduction-ops"
)

iree_tf_benchmark_suite(
  MODELS
    MobileNetV2
    MobileNetV3Small
  MODEL_SCRIPT
    applications_benchmark.py
  MODEL_SCRIPT_ARGS
    "--data=imagenet"
    "--use_external_weights=True"
  NEED_ARG_FOR_MODEL
  BENCHMARK_MODE
    "fp32-full-inference"
  TARGET_BACKEND
    iree_vulkan
  TARGET_ARCH
    "GPU-Mali-Valhall"
  COMPILATION_FLAGS
    "--iree-vulkan-target-triple=valhall-g77-unknown-android10"
    "--iree-flow-inline-constants-max-byte-length=16"
    "--iree-flow-dispatch-formation-enable-operand-fusion"
    "--iree-enable-fusion-with-reduction-ops"
)
