# Copyright 2022 The IREE Authors
#
# Licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

steps:
  - label: "Run x86 benchmark pipeline"
    trigger: "jerry-x86-benchmark-pipeline"
    if: "build.pull_request.id == null || (build.pull_request.labels includes 'buildkite:benchmark-x86')"

  - label: "Run Android benchmark pipeline"
    trigger: "iree-benchmark"
    if: "build.pull_request.id == null || (build.pull_request.labels includes 'buildkite:benchmark')"

  - wait

  - label: "Comment benchmark results on pull request"
    commands:
      - "git clean -fdx"
      - "buildkite-agent artifact download benchmark-results-*.json ./ --build $BUILDKITE_TRIGGERED_FROM_BUILD_ID"
      - "python3 build_tools/benchmarks/post_benchmarks_as_pr_comment.py --verbose --query-base --comment_subtitle=\" (experimental x86)\" benchmark-results-*.json"
    key: "post-on-pr-x86"
    if: "build.pull_request.id != null && (build.pull_request.labels includes 'buildkite:benchmark-x86')"
    agents:
      - "queue=report"
