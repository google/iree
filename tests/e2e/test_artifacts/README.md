IREE E2E Test Artifacts Suite
===============================

IREE E2E test artifacts suite is a collection of artifacts for e2e tests and
benchmarking, which usually depend on external models and module compilations.

Update the test artifacts
-------------------------

All the test artifacts are defined by the python modules. To add/remove/update
these artifacts, modify the related python modules and regenerate the CMake
files with the command below:

```sh
build_tools/scripts/generate_cmake_files.sh
```

Here are the places to find the definitions of the artifacts:
- Model sources: [build_tools/python/e2e_test_framework/models](/build_tools/python/e2e_test_framework/models)
- Benchmarks: [build_tools/python/benchmark_suites](/build_tools/python/benchmark_suites)

Debug build errors
------------------

When there is a build error with e2e test artifacts, you can find the cmake
build target (or the output file) in [generated_e2e_test_iree_artifacts.cmake](/tests/e2e/test_artifacts/generated_e2e_test_iree_artifacts.cmake).
From there you will find the rules and flags used to build the target.

Rules for module build target and model import target also have comments that
annotate the config ids they are generated with. For instance:
```cmake
# Generate with CompileConfig id: 8da35f2b-a042-4b7d-9dcf-5ebbc1728765
iree_bytecode_module(
  ...
)
```
Those ids are defined as constants in [unique_ids.py](/build_tools/python/e2e_test_framework/unique_ids.py).

In case you need to fix the source that generates the target, by searching the
code references of the id constant, you should be able to find the code (usually
a python script) that uses it to generate the configs. Note that some config ids
have suffixes after the UUID for similar but small variations generated by code.

In this example, it's `IREE_COMPILE_CONFIG_ANDROID_VALHALL_MALI_DEFAULTS`
defines that UUID. By searching the references, you will see how it is used in
[mali_benchmarks.py](/build_tools/python/benchmark_suites/iree/mali_benchmarks.py)
to generate `ModuleGenerationConfig` objects, which are eventually translated
into module build targets at [iree_rule_generator.py](/build_tools/python/e2e_test_artifacts/cmake_generator/iree_rule_generator.py).

If the problem is related to source models, they are fetched by the rules in
[generated_e2e_test_fetch_models.cmake](/tests/e2e/test_artifacts/generated_e2e_test_fetch_models.cmake).
Each model have a UUID in its name, which is also defined in [unique_ids.py](/build_tools/python/e2e_test_framework/unique_ids.py).
You should find the model definitions under [build_tools/python/e2e_test_framework/models](/build_tools/python/e2e_test_framework/models).
